<task:Scenario
  xmlns:task="class:/spiralcraft/task/"
  xmlns:query="class:/spiralcraft/data/query/"
  xmlns:dtask="class:/spiralcraft/data/task/"
  xmlns:test="class:/spiralcraft/test/"
  xmlns:example="class:/spiralcraft/data/test/example/"
  >
  <chain>
    <task:Session>
      <type x="[@example:BatchSession].type"/>
    </task:Session>
    
    <dtask:Collect>
    
      <x>[example:BatchSession].results
      </x>
          
      <logTaskResults>false
      </logTaskResults>

    </dtask:Collect>
    
    <dtask:Fetch>
          
      <query>
        <query:Scan>
          <type x="[@example:Customer].type"/>
        </query:Scan>
      </query>
    </dtask:Fetch>
    
    <task:Sequence>
      <scenarios>
        <task:Batch>
          <source>[example:Customer.list]
          </source>
                      
          <chain>
            <task:Exec>
              <commandX>[dtask:Collect] commandAdd([example:Customer])
              </commandX>
            </task:Exec>
          </chain>
        </task:Batch>
        
        <task:Batch>
          <source>[example:Customer.list]
          </source>

          <parallel>true
          </parallel>
                      
          <chain>
            <task:Exec>
              <commandX>[dtask:Collect] commandAdd([example:Customer])
              </commandX>
            </task:Exec>
          </chain>
        </task:Batch>
      </scenarios>
    </task:Sequence>

    <test:Stub>
      <messageX>""+[example:BatchSession].results+" results"
      </messageX>
    </test:Stub>
 
  </chain>
        
</task:Scenario>
