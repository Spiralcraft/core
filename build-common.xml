<project name="build-common">

  <property file="build.number"/>
  <property 
    name="build.name" value="spiralcraft-${module}-${version}-b${build.number}"
  />
  <property name="manifest.class.path" value="" />
  <property environment="env"/>
  
  <target name="build" depends="compile,jar,smoke" />
  
  <target name="compile">
    <buildnumber/>
    <echo message= "build: ${build.name}"/>
    <echo message= "env: ${spiralcraft.devtools}"/>
    <javac 
      classpath="${classpath}"
      srcdir="source" 
      debug="true"
      deprecation="true"
    />
  </target>

  <target name="smoke" depends="jar">
    <java
      classpath="${spiralcraft.devtools}/lib/bsh.jar;lib/spiralcraft-${module}.jar;${classpath}"
      classname="bsh.Interpreter" 
      failonerror="true"
      fork="true"
      >
      <arg value="smoke.bsh"/>
    </java>
  </target>
  
  <target name="jar" depends="compile">
    <echo message= "jar: ${build.name}"/>
    <jar 
      destfile="lib/spiralcraft-${module}.jar" 
      basedir="source"
      includes="spiralcraft/**/*.class,spiralcraft/**/*.xml"
      >
     <Manifest>
        <attribute name="Class-Path" value="${manifest.class.path}"/>
     </Manifest>
       
    </jar>
  </target>

  <target name="doc" depends="build">
    <javadoc 
      classpath="source:${classpath}"
      sourcepath="source"
      packagenames="spiralcraft.**.**"
      header="spiralcraft-${module}-${version} API"
      destdir="docs/api"
      author="Spiralcraft, Inc."
      version="${version}-b${build.number}"
      use="true"
      windowtitle="spiralcraft-${module}-${version} API"
      doctitle="&lt;h1&gt;spiralcraft-${module}-${version} API&lt;/h1&gt;"
      maxmemory="90M"
      failonerror="true"
      >
      <bottom>Copyright 1998,2007 Michael Toth, Spiralcraft, Inc.
      </bottom>
    </javadoc>
  </target>
  
</project>

